@startuml Web3 Voting System Architecture

!allowmixing
!define RECTANGLE class
skinparam backgroundColor #1a1a2e
skinparam defaultFontColor #eaeaea
skinparam defaultFontName JetBrains Mono
skinparam shadowing false

skinparam component {
    BackgroundColor #16213e
    BorderColor #0f3460
    FontColor #e94560
}

skinparam package {
    BackgroundColor #0f3460
    BorderColor #533483
    FontColor #00fff5
}

skinparam rectangle {
    BackgroundColor #16213e
    BorderColor #e94560
    FontColor #eaeaea
    RoundCorner 15
}

skinparam arrow {
    Color #00fff5
    FontColor #eaeaea
}

skinparam note {
    BackgroundColor #533483
    BorderColor #e94560
    FontColor #eaeaea
}

title <size:24><color:#00fff5>Web3 æ¨¡å—åŒ–æŠ•ç¥¨ç³»ç»Ÿæ¶æ„</color></size>\n<size:14><color:#e94560>Modular Voting System with Homomorphic Encryption & Semaphore</color></size>

' ==================== é…ç½®æ¨¡å—å±‚ ====================
package "é…ç½®æ¨¡å—å±‚ (Configuration Modules)" as ConfigLayer #0f3460 {
    
    rectangle "ğŸ—³ï¸ **æŠ•ç¥¨è§„åˆ™**\n(Voting Rule)" as VotingRule #16213e {
        rectangle "ç®€å•å¤šæ•°" as SimpleVote #1a1a2e
        rectangle "åŠ æƒæŠ•ç¥¨" as WeightedVote #1a1a2e
        rectangle "äºŒæ¬¡æ–¹æŠ•ç¥¨" as QuadraticVote #1a1a2e
        rectangle "æ’åºé€‰æ‹©" as RankedChoice #1a1a2e
    }
    
    rectangle "ğŸ” **å‡†å…¥æ§åˆ¶**\n(Access Control)" as AccessControl #16213e {
        rectangle "TokenæŒæœ‰" as TokenGate #1a1a2e
        rectangle "NFTæŒæœ‰" as NFTGate #1a1a2e
        rectangle "ç™½åå•" as Whitelist #1a1a2e
        rectangle "Semaphoreç¾¤ç»„" as SemaphoreGroup #1a1a2e
    }
    
    rectangle "ğŸ›¡ï¸ **éšç§ä¿æŠ¤**\n(Privacy)" as Privacy #16213e {
        rectangle "å…¬å¼€æŠ•ç¥¨" as PublicVote #1a1a2e
        rectangle "åŒ¿åæŠ•ç¥¨\n(Semaphore)" as AnonVote #1a1a2e
        rectangle "åŠ å¯†æŠ•ç¥¨\n(åŒæ€åŠ å¯†)" as EncryptedVote #1a1a2e
        rectangle "å®Œå…¨éšç§" as FullPrivacy #1a1a2e
    }
    
    rectangle "â±ï¸ **æ—¶é—´æ§åˆ¶**\n(Timing)" as Timing #16213e {
        rectangle "å›ºå®šæ—¶æ®µ" as FixedPeriod #1a1a2e
        rectangle "åŒºå—é«˜åº¦" as BlockHeight #1a1a2e
        rectangle "åŠ¨æ€å»¶é•¿" as DynamicExtend #1a1a2e
        rectangle "å¿«ç…§æŠ•ç¥¨" as Snapshot #1a1a2e
    }
    
    rectangle "ğŸ“Š **ç»“æœæ­ç¤º**\n(Result Revelation)" as ResultReveal #16213e {
        rectangle "å®æ—¶å…¬å¼€" as Realtime #1a1a2e
        rectangle "æŠ•ç¥¨ç»“æŸå" as AfterEnd #1a1a2e
        rectangle "é˜ˆå€¼è§£å¯†" as ThresholdDecrypt #1a1a2e
        rectangle "å»¶è¿Ÿæ­ç¤º" as DelayedReveal #1a1a2e
    }
    
    rectangle "âš¡ **æ‰§è¡Œæœºåˆ¶**\n(Execution)" as Execution #16213e {
        rectangle "é“¾ä¸Šè‡ªåŠ¨æ‰§è¡Œ" as OnChainAuto #1a1a2e
        rectangle "å¤šç­¾è§¦å‘" as MultiSig #1a1a2e
        rectangle "Timelockæ‰§è¡Œ" as Timelock #1a1a2e
        rectangle "é“¾ä¸‹é€šçŸ¥" as OffChainNotify #1a1a2e
    }
}

' ==================== æ ¸å¿ƒåè®®å±‚ ====================
package "æ ¸å¿ƒåè®®å±‚ (Core Protocol Layer)" as CoreLayer #533483 {
    
    rectangle "**æŠ•ç¥¨æ ¸å¿ƒåˆçº¦**\n(Voting Core Contract)" as VotingCore #16213e {
        component "é…ç½®ç®¡ç†å™¨" as ConfigManager
        component "çŠ¶æ€æœº" as StateMachine
        component "äº‹ä»¶å‘å°„å™¨" as EventEmitter
    }
    
    rectangle "**åŠ å¯†æ¨¡å—**\n(Cryptography Module)" as CryptoModule #16213e {
        component "PaillieråŒæ€åŠ å¯†\n(åŠ æ³•åŒæ€)" as Paillier
        component "å¯†é’¥ç®¡ç†" as KeyManager
        component "é˜ˆå€¼è§£å¯†åè®®" as ThresholdDecryption
    }
    
    rectangle "**èº«ä»½æ¨¡å—**\n(Identity Module)" as IdentityModule #16213e {
        component "Semaphoreåè®®" as Semaphore
        component "ç¾¤ç»„ç®¡ç†" as GroupManager
        component "é›¶çŸ¥è¯†è¯æ˜éªŒè¯" as ZKVerifier
    }
}

' ==================== æŠ•ç¥¨æµç¨‹å±‚ ====================
package "æŠ•ç¥¨æµç¨‹ (Voting Process Flow)" as ProcessLayer #0f3460 {
    
    rectangle "**Step 1: åˆ›å»ºé€‰ç¥¨**\n(Create Ballot)" as Step1 #e94560 {
        note right of Step1
            â€¢ é…ç½®å…­å¤§æ¨¡å—å‚æ•°
            â€¢ è®¾ç½®æŠ•ç¥¨é€‰é¡¹
            â€¢ ç”ŸæˆåŠ å¯†å…¬é’¥
            â€¢ åˆ›å»ºSemaphoreç¾¤ç»„
        end note
    }
    
    rectangle "**Step 2: é€‰æ°‘æ³¨å†Œ**\n(Voter Registration)" as Step2 #e94560 {
        note right of Step2
            â€¢ å‡†å…¥æ§åˆ¶éªŒè¯
            â€¢ ç”Ÿæˆèº«ä»½æ‰¿è¯º
            â€¢ åŠ å…¥Semaphoreç¾¤ç»„
            â€¢ è·å–æŠ•ç¥¨å‡­è¯
        end note
    }
    
    rectangle "**Step 3: æŠ•ç¥¨**\n(Cast Vote)" as Step3 #e94560 {
        note right of Step3
            â€¢ ç”ŸæˆZKè¯æ˜(Semaphore)
            â€¢ åŒæ€åŠ å¯†æŠ•ç¥¨å†…å®¹
            â€¢ æäº¤åŠ å¯†é€‰ç¥¨
            â€¢ é˜²æ­¢åŒé‡æŠ•ç¥¨
        end note
    }
    
    rectangle "**Step 4: è®¡ç¥¨**\n(Tally)" as Step4 #e94560 {
        note right of Step4
            â€¢ åŒæ€èšåˆåŠ å¯†ç¥¨æ•°
            â€¢ é˜ˆå€¼è§£å¯†æ­ç¤ºç»“æœ
            â€¢ éªŒè¯è®¡ç¥¨æ­£ç¡®æ€§
            â€¢ å‘å¸ƒä¸­é—´çŠ¶æ€
        end note
    }
    
    rectangle "**Step 5: ç»“æœå…¬å¸ƒä¸éªŒè¯**\n(Result Publication & Verification)" as Step5 #e94560 {
        note right of Step5
            â€¢ å…¬å¸ƒæœ€ç»ˆç»“æœ
            â€¢ æä¾›å¯éªŒè¯è¯æ˜
            â€¢ è§¦å‘æ‰§è¡Œæœºåˆ¶
            â€¢ å­˜æ¡£æŠ•ç¥¨è®°å½•
        end note
    }
}

' ==================== æ•°æ®å±‚ ====================
package "æ•°æ®å­˜å‚¨å±‚ (Data Storage Layer)" as DataLayer #16213e {
    database "é“¾ä¸Šå­˜å‚¨\n(On-Chain)" as OnChain {
        rectangle "æŠ•ç¥¨çŠ¶æ€" as VoteState #1a1a2e
        rectangle "Merkleæ ‘æ ¹" as MerkleRoot #1a1a2e
        rectangle "åŠ å¯†ç¥¨æ•°" as EncryptedTally #1a1a2e
    }
    
    database "é“¾ä¸‹å­˜å‚¨\n(IPFS/Arweave)" as OffChain {
        rectangle "æŠ•ç¥¨è¯¦æƒ…" as VoteDetails #1a1a2e
        rectangle "ZKè¯æ˜" as ZKProofs #1a1a2e
        rectangle "å®¡è®¡æ—¥å¿—" as AuditLogs #1a1a2e
    }
}

' ==================== å…³ç³»è¿æ¥ ====================
' é…ç½®æ¨¡å— -> æ ¸å¿ƒå±‚
VotingRule --> ConfigManager : é…ç½®
AccessControl --> ConfigManager : é…ç½®
Privacy --> ConfigManager : é…ç½®
Timing --> ConfigManager : é…ç½®
ResultReveal --> ConfigManager : é…ç½®
Execution --> ConfigManager : é…ç½®

' æ ¸å¿ƒå±‚å†…éƒ¨
ConfigManager --> StateMachine
CryptoModule <--> VotingCore
IdentityModule <--> VotingCore

' æµç¨‹æ­¥éª¤
Step1 --> Step2 : åˆ›å»ºå®Œæˆ
Step2 --> Step3 : æ³¨å†Œå®Œæˆ
Step3 --> Step4 : æŠ•ç¥¨ç»“æŸ
Step4 --> Step5 : è®¡ç¥¨å®Œæˆ

' æµç¨‹ -> æ ¸å¿ƒå±‚
Step1 ..> VotingCore : åˆå§‹åŒ–
Step2 ..> IdentityModule : èº«ä»½æ³¨å†Œ
Step3 ..> Semaphore : åŒ¿åè¯æ˜
Step3 ..> Paillier : åŠ å¯†æŠ•ç¥¨
Step4 ..> ThresholdDecryption : è§£å¯†èšåˆ
Step5 ..> EventEmitter : ç»“æœå‘å¸ƒ

' æ ¸å¿ƒå±‚ -> æ•°æ®å±‚
VotingCore --> OnChain : çŠ¶æ€å†™å…¥
IdentityModule --> MerkleRoot : æ›´æ–°æ ¹
CryptoModule --> EncryptedTally : å­˜å‚¨åŠ å¯†ç¥¨
VotingCore --> OffChain : å…ƒæ•°æ®å­˜å‚¨

' ==================== å›¾ä¾‹ ====================
legend right
    |<#e94560> **æµç¨‹æ­¥éª¤** |
    |<#16213e> **åŠŸèƒ½æ¨¡å—** |
    |<#533483> **æ ¸å¿ƒåè®®** |
    |<#0f3460> **é…ç½®é€‰é¡¹** |
    ====
    **åŠ å¯†æŠ€æœ¯æ ˆ:**
    â€¢ Paillier åŠ æ³•åŒæ€åŠ å¯†
    â€¢ Semaphore é›¶çŸ¥è¯†èº«ä»½
    â€¢ Merkle Tree æˆå‘˜è¯æ˜
endlegend

footer <size:12><color:#00fff5>Web3 Modular Voting System | Homomorphic Encryption + Semaphore ZKP</color></size>

@enduml

